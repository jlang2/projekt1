<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="https://unpkg.com/react@16.9.0/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@16.9.0/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="resurs.js"></script>
	<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8">
</head>
<body>
<div id="root"></div>
	
<script type="text/babel">
	let jsonDataText;

	function updateState(isUndefined) {
		isUndefined = true;
    	this.setState({isUndefined});
	}

  	class SelectContainer extends React.Component {
		constructor() {
			super()
			this.state = {
        		isHidden: true
        
			}
		}
		toggleHidden() {
			this.setState({
        		isHidden: !this.state.isHidden
			})
      }
      
		render() {
			return (
        		<div>
          			<select id="category" name="category" onChange={this.toggleHidden.bind(this)}>
						<option value="BDA">BDA</option>
						<option value="IT-Bachelor">IT-Bachelor</option>					
					</select>
          			{this.state.isHidden && <BDAKurser />}
          			{!this.state.isHidden && <IAKurser />} 
				</div>
			)
		}
    }
    
    

	class BDAKurser extends React.Component {
		constructor() {
			super()
			if (localStorage.getItem("jsondata") != null) {
				jsonDataText = localStorage.getItem("jsondata");
				jsondata = JSON.parse(jsonDataText);
			}
		}

		render() {
			return (
				<select id="kurserSelect">
					{
						jsondata.Program.BDA.Kurser.map((bdakurser) => {
							return (
								<option value={bdakurser.namn + "+" + bdakurser.kurskod + "+" + bdakurser.timmar + "+" + bdakurser.period }>{bdakurser.namn}</option>
							);
						})
					}
				</select>
			);
		}
    }
 

	class IAKurser extends React.Component {
		constructor() {
			super()
			if (localStorage.getItem("jsondata") != null) {
				jsonDataText = localStorage.getItem("jsondata");
				jsondata = JSON.parse(jsonDataText);
			}
		}
		render() {
			return (
				<select id="kurserSelect">
					{
						jsondata.Program.IA.Kurser.map((iakurser) =>  {
							return (
								<option value={iakurser.namn + "+" + iakurser.kurskod + "+" + iakurser.timmar + "+" + iakurser.period }>{iakurser.namn}</option>
							);
						})
					}
				</select>
			);
		}
	}
	
	class Personal extends React.Component {
		constructor() {
			super()
			if (localStorage.getItem("jsondata") != null) {
				jsonDataText = localStorage.getItem("jsondata");
				jsondata = JSON.parse(jsonDataText);
			}
		}
		render() {
			return (
				<select id="personalSelect">
					{
						jsondata.Personal.map((person) => {
							return (
								<option value={person.Förnamn + " " + person.Efternamn}>{person.Förnamn + " " + person.Efternamn}</option>
							);	
						})
					}
				</select>
			);
		}
	}
	     		 
	class Send extends React.Component {
		constructor() {
			super();
			this.dataToJson = this.dataToJson.bind(this);
		}
		
		dataToJson() {
			const kursArray = kurserSelect.value.split("+");
				if(jsondata.active[0] == undefined) {
						jsondata.active = [{
							Lektor: personalSelect.value,            
							Kurs: kursArray[0],
							Kurskod: kursArray[1],
							Timmar: kursArray[2],
							Period: kursArray[3]           						
						}];
        		} else {
					for(let i = 0; i < jsondata.active.length; i++) {
						if(jsondata.active[i].Kurs == kursArray[0]) {
							alert("Någon har redan valt denna kurs.");
						} else {
							jsondata.active.push({
								Lektor: personalSelect.value,
								Kurs: kursArray[0],
								Kurskod: kursArray[1],
								Timmar: kursArray[2],
								Period: kursArray[3]
							});
						}
					}
				}
		var jsonDataText = JSON.stringify(jsondata);
		localStorage.setItem("jsondata", jsonDataText);
		}

		wrapperFunction = () => {
			this.dataToJson();
			updateState();
		}
			
			render() {
				return (
					<input type="button" name="button" id="button" onClick={this.wrapperFunction} value="Skicka"></input>
				);
			}
    }


    
	class TableData extends React.Component {
		constructor() {
			super()
				if (localStorage.getItem("jsondata") != null) {
					jsonDataText = localStorage.getItem("jsondata");
					jsondata = JSON.parse(jsonDataText);
				}
		}

		render () {
			return (
				jsondata.active.map((x) => {
					if (x.Period == 1){
						return (
							<tr>
								<td>{x.Lektor}</td>
								<td>{x.Kurs + " " + x.Kurskod}</td>
								<td>{x.Timmar}</td>
								<td></td>                  
								<td></td>
								<td></td>
							</tr>
						);
					}
			
							
					if (x.Period == 2){
						return (	
							<tr>
								<td>{x.Lektor}</td>
								<td>{x.Kurs + " " + x.Kurskod}</td>
								<td></td>
								<td>{x.Timmar}</td>
								<td></td>
								<td></td>
							</tr>
						);
					}

					if (x.Period == 3){
						return (	
							<tr>
								<td>{x.Lektor}</td>
								<td>{x.Kurs + " " + x.Kurskod}</td>
								<td></td>
								<td></td>
								<td>{x.Timmar}</td>
								<td></td>
							</tr>
						);
					} else {
						return (	
							<tr>
								<td>{x.Lektor}</td>
								<td>{x.Kurs + " " + x.Kurskod}</td>
								<td></td>
								<td></td>
								<td></td>
								<td>{x.Timmar}</td>
								
							</tr>
						);
					}
				})	
			)
		}
	}
   
		// kurser
	class Table extends React.Component {
		constructor(props) {
			super(props)
			if (localStorage.getItem("jsondata") != null) {
				jsonDataText = localStorage.getItem("jsondata");
				jsondata = JSON.parse(jsonDataText);
			} else {
				jsondata.active = new Object();
			}

			if(jsondata.active[0] == undefined) {
				this.state = {
					isUndefined: false
				}
				console.log(this.state);
			} else {
				this.state = {
					isUndefined: true
				}
				console.log(this.state);
			}
			updateState = updateState.bind(this)
		}

		render () {
			return (
				<table id="idtable"> 
					<tr id="tr1">
						<th id="lektor">Lektor</th>   							   
              			<th id="k1">Kurser</th>
              			
						<th id="p1">P1</th> 
						<th id="p2">P2</th>
						<th id ="p3">P3</th>
                		<th id="p4">P4</th>
					</tr>
					{this.state.isUndefined && <TableData />}
				</table>
			)
		}
    }
    
	class Container extends React.Component {
		render () {
			return (
				<div>
					<Table />
           			<Send />
				</div>
			)
		}
	}

        ReactDOM.render(
			<div id="idtable">
				<SelectContainer />
				<Personal />
				
				<Container />
			</div>,                                                        
                document.getElementById("root")    
            );


</script>



<br>
</body>
</html>